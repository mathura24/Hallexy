<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orders Table</title>

  <style>
    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: #fff;
    }
    .header { padding: 20px; }
    .header h2 {
      margin: 0; font-size: 22px; font-weight: 600;
    }
    .tabs {
      padding: 0 20px;
      display: flex;
      gap: 18px;
      margin-bottom: 8px;
    }
    .tab {
      padding: 8px 14px;
      background: #f3f3f3;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      border: none;
      color: #333;
    }
    .active {
      background: #e3f7ec;
      color: #0a9b48;
      border: 1px solid #b8e6c8;
    }

    .container {
      display: flex;
      justify-content: center;
      text-align: center;
      margin-top: 120px;
    }
    .table-icon {
      font-size: 50px;
      opacity: 0.5;
    }
    .create-btn {
      padding: 12px 20px;
      border-radius: 6px;
      background: #2ecc71;
      color: #fff;
      border: none;
      cursor: pointer;
      margin-top: 12px;
    }

    /* ---------------- POPUP OVERLAY ---------------- */
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.15);
      display: none; /* initially hidden */
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    /* ---------------- POPUP CONTAINER ---------------- */
    .popup {
      width: 780px;
      background: #fff;
      border-radius: 10px;
      padding: 20px 28px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-height: 90vh;
      overflow-y: auto;
    }

    .popup h3 { margin-top: 0; }
    .close-btn {
      float: right;
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
    }

    /* Form Layout */
    .section-title {
      font-weight: 600;
      margin-top: 18px;
      margin-bottom: 8px;
    }
    .row {
      display: flex;
      gap: 14px;
      margin-bottom: 12px;
    }
    .row input,
    .row select {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .footer-btns {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .cancel-btn {
      padding: 8px 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
    }
    .submit-btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      background: #2ecc71;
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>

<body>

<header class="header">
  <h2>üìã Customer Orders</h2>
  <p>View and manage customer orders and details</p>
</header>

<nav class="tabs">
  <button class="tab" onclick="window.location.href='main.html'">üìä Dashboard</button>
  <button class="tab active">Table</button>
</nav>

<div id="emptyState" class="container">
  <div>
    <div class="table-icon">üìë</div>
    <h3>No Orders Yet</h3>
    <p>Click Create Order and enter your order information</p>
    <button class="create-btn" onclick="openPopup()">‚ûï Create order</button>
  </div>
</div>

<div id="tableContainer" style="display:none; padding:20px;">
  <div style="margin-bottom:20px;">
    <button class="create-btn" onclick="openPopup()">‚ûï Create order</button>
  </div>
  <table id="ordersTable" style="width:100%; border-collapse:collapse;">
    <thead>
      <tr style="background:#f5f5f5; border-bottom:2px solid #ddd;">
        <th style="padding:12px; text-align:left;">S.No</th>
        <th style="padding:12px; text-align:left;">Customer ID</th>
        <th style="padding:12px; text-align:left;">Customer name</th>
        <th style="padding:12px; text-align:left;">Email id</th>
        <th style="padding:12px; text-align:left;">Phone number</th>
        <th style="padding:12px; text-align:left;">Address</th>
        <th style="padding:12px; text-align:left;">Order ID</th>
        <th style="padding:12px; text-align:left;">Order date</th>
        <th style="padding:12px; text-align:center;">Actions</th>
      </tr>
    </thead>
    <tbody id="tableBody">
    </tbody>
  </table>
</div>

<!-- ---------------------- POPUP UI ---------------------- -->
<div class="overlay" id="popupOverlay">
  <div class="popup">
    <span class="close-btn" onclick="closePopup()">√ó</span>
    <h3 id="popupTitle">Create order</h3>

    <div class="section-title">Customer Information</div>

    <div class="row">
      <input type="text" id="firstName" placeholder="First name *">
      <input type="text" id="emailId" placeholder="Email id *">
    </div>
    <div class="row">
      <input type="text" id="lastName" placeholder="Last name *">
      <input type="text" id="phoneNumber" placeholder="Phone number *">
    </div>
    <div class="row">
      <input type="text" id="streetAddress" placeholder="Street Address *">
    </div>
    <div class="row">
      <input type="text" id="city" placeholder="City *">
      <input type="text" id="stateProvince" placeholder="State / Province *">
    </div>
    <div class="row">
      <input type="text" id="postalCode" placeholder="Postal code *">
      <select id="country">
        <option value="">Country *</option>
        <option value="United States">United States</option>
        <option value="Canada">Canada</option>
        <option value="Australia">Australia</option>
        <option value="Singapore">Singapore</option>
        <option value="Hong Kong">Hong Kong</option>
      </select>
    </div>

    <div class="section-title">Order Information</div>

    <div class="row">
      <select id="product">
        <option value="">Choose product *</option>
        <option value="Fiber Internet 300 Mbps">Fiber Internet 300 Mbps</option>
        <option value="5G Unlimited Mobile Plan">5G Unlimited Mobile Plan</option>
        <option value="Fiber Internet 1 Gbps">Fiber Internet 1 Gbps</option>
        <option value="Business Internet 500 Mbps">Business Internet 500 Mbps</option>
        <option value="VoIP Corporate Package">VoIP Corporate Package</option>
      </select>
    </div>
    <div class="row">
      <input type="number" id="quantity" placeholder="Quantity *" value="1" min="1">
      <input type="number" id="unitPrice" placeholder="Unit price *" step="0.01">
    </div>
    <div class="row">
      <input type="text" id="totalAmount" placeholder="Total amount *" readonly style="background:#f5f5f5;">
      <select id="status">
        <option value="Pending">Pending</option>
        <option value="In progress">In progress</option>
        <option value="Completed">Completed</option>
      </select>
    </div>
    <div class="row">
      <select id="createdBy">
        <option value="">Created by *</option>
        <option value="Mr. Michael Harris">Mr. Michael Harris</option>
        <option value="Mr. Ryan Cooper">Mr. Ryan Cooper</option>
        <option value="Ms. Olivia Carter">Ms. Olivia Carter</option>
        <option value="Mr. Lucas Martin">Mr. Lucas Martin</option>
      </select>
    </div>

    <div id="validationError" style="color:#d32f2f; font-size:12px; margin-top:10px; display:none;"></div>

    <div class="footer-btns">
      <button class="cancel-btn" onclick="closePopup()">Cancel</button>
      <button class="submit-btn" onclick="submitForm()">Submit</button>
    </div>
  </div>
</div>

<script>
  let orders = JSON.parse(localStorage.getItem('customerOrders')) || [];
  let editingIndex = -1;

  // Calculate total amount when quantity or price changes
  document.getElementById('quantity').addEventListener('change', calculateTotal);
  document.getElementById('unitPrice').addEventListener('change', calculateTotal);

  function calculateTotal() {
    const qty = parseFloat(document.getElementById('quantity').value) || 0;
    const price = parseFloat(document.getElementById('unitPrice').value) || 0;
    const total = (qty * price).toFixed(2);
    document.getElementById('totalAmount').value = '$' + total;
  }

  function openPopup() {
    editingIndex = -1;
    document.getElementById('popupTitle').innerText = 'Create order';
    clearForm();
    document.getElementById('popupOverlay').style.display = 'flex';
    document.getElementById('quantity').value = '1';
    document.getElementById('status').value = 'Pending';
  }

  function closePopup() {
    document.getElementById('popupOverlay').style.display = 'none';
    clearForm();
  }

  function clearForm() {
    document.getElementById('firstName').value = '';
    document.getElementById('lastName').value = '';
    document.getElementById('emailId').value = '';
    document.getElementById('phoneNumber').value = '';
    document.getElementById('streetAddress').value = '';
    document.getElementById('city').value = '';
    document.getElementById('stateProvince').value = '';
    document.getElementById('postalCode').value = '';
    document.getElementById('country').value = '';
    document.getElementById('product').value = '';
    document.getElementById('quantity').value = '1';
    document.getElementById('unitPrice').value = '';
    document.getElementById('totalAmount').value = '';
    document.getElementById('status').value = 'Pending';
    document.getElementById('createdBy').value = '';
    document.getElementById('validationError').style.display = 'none';
  }

  function validateForm() {
    const fields = [
      'firstName', 'lastName', 'emailId', 'phoneNumber', 'streetAddress',
      'city', 'stateProvince', 'postalCode', 'country', 'product',
      'quantity', 'unitPrice', 'status', 'createdBy'
    ];

    for (let field of fields) {
      if (!document.getElementById(field).value.trim()) {
        showValidationError('Please fill the field');
        return false;
      }
    }
    return true;
  }

  function showValidationError(message) {
    const error = document.getElementById('validationError');
    error.innerText = message;
    error.style.display = 'block';
  }

  function submitForm() {
    if (!validateForm()) return;

    const order = {
      firstName: document.getElementById('firstName').value,
      lastName: document.getElementById('lastName').value,
      emailId: document.getElementById('emailId').value,
      phoneNumber: document.getElementById('phoneNumber').value,
      streetAddress: document.getElementById('streetAddress').value,
      city: document.getElementById('city').value,
      stateProvince: document.getElementById('stateProvince').value,
      postalCode: document.getElementById('postalCode').value,
      country: document.getElementById('country').value,
      product: document.getElementById('product').value,
      quantity: parseInt(document.getElementById('quantity').value),
      unitPrice: parseFloat(document.getElementById('unitPrice').value),
      totalAmount: parseFloat(document.getElementById('unitPrice').value) * 
                   parseInt(document.getElementById('quantity').value),
      status: document.getElementById('status').value,
      createdBy: document.getElementById('createdBy').value,
      createdDate: new Date().toISOString().split('T')[0]
    };

    // generate IDs when creating a new order
    if (editingIndex >= 0) {
      // preserve existing ids when editing
      order.customerId = orders[editingIndex].customerId || generateCustomerId();
      order.orderId = orders[editingIndex].orderId || generateOrderId();
      orders[editingIndex] = order;
    } else {
      order.customerId = generateCustomerId();
      order.orderId = generateOrderId();
      orders.push(order);
    }

    localStorage.setItem('customerOrders', JSON.stringify(orders));
    closePopup();
    loadTable();
    showSuccessToast(order.orderId);
  }

  // helpers to generate sequential IDs (CUST-0001, ORD-0001)
  function getMaxNumberFromIds(keyPrefix) {
    let max = 0;
    for (const o of orders) {
      const id = (o.orderId && keyPrefix === 'ORD') ? o.orderId : (o.customerId && keyPrefix === 'CUST') ? o.customerId : null;
      if (!id) continue;
      const parts = id.split('-');
      const num = parseInt(parts[1]);
      if (!isNaN(num) && num > max) max = num;
    }
    return max;
  }

  function pad(num, size) { return num.toString().padStart(size, '0'); }

  function generateOrderId() {
    const max = getMaxNumberFromIds('ORD');
    return 'ORD-' + pad(max + 1, 4);
  }

  function generateCustomerId() {
    const max = getMaxNumberFromIds('CUST');
    return 'CUST-' + pad(max + 1, 4);
  }

  function loadTable() {
    const emptyState = document.getElementById('emptyState');
    const tableContainer = document.getElementById('tableContainer');
    const tableBody = document.getElementById('tableBody');

    if (orders.length === 0) {
      emptyState.style.display = 'flex';
      tableContainer.style.display = 'none';
    } else {
      emptyState.style.display = 'none';
      tableContainer.style.display = 'block';
      tableBody.innerHTML = '';

      orders.forEach((order, index) => {
        const row = document.createElement('tr');
        row.style.borderBottom = '1px solid #eee';
        const address = `${order.streetAddress || ''}${order.city ? ', ' + order.city : ''}${order.stateProvince ? ', ' + order.stateProvince : ''}${order.postalCode ? ', ' + order.postalCode : ''}${order.country ? ', ' + order.country : ''}`;
        row.innerHTML = `
          <td style="padding:12px;">${index + 1}</td>
          <td style="padding:12px;">${order.customerId || ''}</td>
          <td style="padding:12px;">${order.firstName} ${order.lastName}</td>
          <td style="padding:12px;">${order.emailId}</td>
          <td style="padding:12px;">${order.phoneNumber}</td>
          <td style="padding:12px;">${address}</td>
          <td style="padding:12px;">${order.orderId || ''}</td>
          <td style="padding:12px;">${formatDate(order.createdDate)}</td>
          <td style="padding:12px; text-align:center;">
            <button onclick="editOrder(${index})" style="background:none; border:none; cursor:pointer; font-size:16px; margin-right:8px;">‚úèÔ∏è</button>
            <button onclick="deleteOrder(${index})" style="background:none; border:none; cursor:pointer; font-size:16px;">üóëÔ∏è</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }
  }

  function formatDate(iso) {
    if (!iso) return '';
    try {
      const d = new Date(iso);
      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: '2-digit' });
    } catch(e) { return iso; }
  }

  // Success toast
  function showSuccessToast(orderId) {
    let toast = document.getElementById('successToast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'successToast';
      toast.style.position = 'fixed';
      toast.style.top = '20px';
      toast.style.right = '20px';
      toast.style.background = '#e4f9ec';
      toast.style.color = '#0a8f43';
      toast.style.border = '1px solid #b8e6c8';
      toast.style.padding = '12px 18px';
      toast.style.borderRadius = '8px';
      toast.style.boxShadow = '0 4px 20px rgba(0,0,0,0.08)';
      toast.style.zIndex = '3000';
      document.body.appendChild(toast);
    }
    toast.innerHTML = `‚úî Nice work! Your new order "${orderId}" is now in the list! <span style="float:right; cursor:pointer; margin-left:12px;" onclick="this.parentElement.style.display='none'">‚úï</span>`;
    toast.style.display = 'block';
    setTimeout(() => { if (toast) toast.style.display = 'none'; }, 4000);
  }

  function editOrder(index) {
    editingIndex = index;
    const order = orders[index];
    
    document.getElementById('popupTitle').innerText = 'Edit order';
    document.getElementById('firstName').value = order.firstName;
    document.getElementById('lastName').value = order.lastName;
    document.getElementById('emailId').value = order.emailId;
    document.getElementById('phoneNumber').value = order.phoneNumber;
    document.getElementById('streetAddress').value = order.streetAddress;
    document.getElementById('city').value = order.city;
    document.getElementById('stateProvince').value = order.stateProvince;
    document.getElementById('postalCode').value = order.postalCode;
    document.getElementById('country').value = order.country;
    document.getElementById('product').value = order.product;
    document.getElementById('quantity').value = order.quantity;
    document.getElementById('unitPrice').value = order.unitPrice;
    document.getElementById('totalAmount').value = '$' + order.totalAmount.toFixed(2);
    document.getElementById('status').value = order.status;
    document.getElementById('createdBy').value = order.createdBy;
    
    document.getElementById('popupOverlay').style.display = 'flex';
  }

  function deleteOrder(index) {
    if (confirm('Are you sure you want to delete this order?')) {
      orders.splice(index, 1);
      localStorage.setItem('customerOrders', JSON.stringify(orders));
      loadTable();
    }
  }

  // Load table on page load
  window.addEventListener('load', loadTable);
  
  // Listen for storage changes from other tabs
  window.addEventListener('storage', loadTable);
</script>

</body>
</html>
