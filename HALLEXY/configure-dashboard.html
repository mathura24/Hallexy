<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard Configuration</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:"Inter",sans-serif; }

body { background:white; }

/* Topbar */
.topbar {
  padding:14px 22px;
  border-bottom:1px solid #e6e6e6;
  display:flex; align-items:center; gap:12px;
}

.topbar h3 { font-size:16px; font-weight:600; }
.topbar p { font-size:12px; color:#777; margin-top:2px; }

.back-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #333;
}

/* Main Layout */
.layout {
  display:grid;
  grid-template-columns:280px 1fr;
  height:calc(100vh - 70px);
  gap: 0;
}

/* Sidebar */
.sidebar {
  border-right:1px solid #e6e6e6;
  padding:20px;
  overflow-y:auto;
  background: #fafafa;
}

.control-group {
  margin-bottom: 20px;
}

.control-label {
  font-size:12px;
  color:#666;
  font-weight:500;
  margin-bottom:6px;
  display:block;
}

.control-input {
  width:100%;
  padding:10px;
  border:1px solid #ddd;
  border-radius:6px;
  font-size:13px;
  background: white;
}

.section-header {
  padding:10px 12px;
  border:1px solid #ddd;
  background:#f5f5f5;
  border-radius:6px;
  font-size:13px;
  margin-top:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  user-select:none;
  font-weight: 500;
}

.section-header:hover {
  background: #efefef;
}

.section-toggle {
  transition:transform 0.3s ease;
}

.section-header.collapsed .section-toggle {
  transform:rotate(-90deg);
}

.section-content {
  display:block;
  max-height: 1000px;
  transition: max-height 0.3s ease;
  overflow: hidden;
}

.section-content.collapsed {
  max-height: 0;
  overflow: hidden;
}

.widget-item {
  border:1px solid #ddd;
  padding:10px 12px;
  font-size:13px;
  border-radius:6px;
  margin-top:8px;
  background:#fff;
  cursor:grab;
  transition: all 0.2s;
}

.widget-item:hover {
  background:#eef6ff;
  border-color:#bcd9ff;
  cursor:grab;
}

.widget-item.dragging {
  opacity: 0.5;
  cursor: grabbing;
}

/* Canvas */
.canvas {
  padding:20px;
  overflow-y:auto;
  background-color: #f5f5f5;
  background-image: 
    linear-gradient(0deg, #e0e0e0 1px, transparent 1px),
    linear-gradient(90deg, #e0e0e0 1px, transparent 1px);
  background-size: 60px 60px;
}

/* Grid system: Desktop 12 columns, Tablet 8 columns, Mobile 4 columns */
.widget-grid {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: 16px;
  margin-bottom: 20px;
}

.widget {
  background:white;
  border:2px solid #ddd;
  border-radius:8px;
  padding:16px;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
  position:relative;
  cursor: move;
  transition: all 0.2s;
}

.widget:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

.widget.dragging {
  opacity: 0.7;
  z-index: 1000;
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}

.widget-title {
  font-size:14px;
  font-weight:600;
  color:#333;
  margin-bottom:8px;
}

.widget-type {
  font-size:11px;
  color:#999;
  margin-bottom:8px;
}

.widget-value {
  font-size:24px;
  font-weight:700;
  color:#0a9b48;
  margin-bottom:4px;
}

.widget-label {
  font-size:12px;
  color:#999;
}

.widget-actions {
  position:absolute;
  top:10px;
  right:10px;
  display:flex;
  gap:8px;
}

.widget-btn {
  width:28px;
  height:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:6px;
  cursor:pointer;
  border: none;
  background: white;
  font-size: 14px;
  transition: all 0.2s;
}

.settings-btn {
  background:#eaf9f1;
  color:#0a8f43;
}

.settings-btn:hover {
  background:#d4f0e6;
}

.delete-btn {
  background:#ffeceb;
  color:#db1818;
}

.delete-btn:hover {
  background:#ffe5e3;
}

/* Config Panel */
.config-panel {
  position:fixed;
  top:0;
  right:-500px;
  width:500px;
  height:100vh;
  background:white;
  box-shadow:-3px 0 15px rgba(0,0,0,0.2);
  padding:22px;
  transition:right 0.35s ease;
  z-index:1001;
  overflow-y:auto;
}

.config-panel.open {
  right:0;
}

.config-panel h3 {
  margin-top:0;
  margin-bottom:20px;
  font-size:16px;
}

.config-group {
  margin-bottom:18px;
}

.config-label {
  font-size:13px;
  font-weight:500;
  color:#555;
  margin-bottom:6px;
  display:block;
}

.config-input,
.config-select,
.config-textarea {
  width:100%;
  padding:10px;
  border:1px solid #ddd;
  border-radius:6px;
  font-size:13px;
  font-family: "Inter", sans-serif;
}

.config-textarea {
  resize: vertical;
  min-height: 80px;
}

.config-input:focus,
.config-select:focus,
.config-textarea:focus {
  outline: none;
  border-color: #0a9b48;
  box-shadow: 0 0 0 3px rgba(10, 155, 72, 0.1);
}

.config-footer {
  display:flex;
  gap:10px;
  justify-content:flex-end;
  margin-top:24px;
  padding-top:20px;
  border-top:1px solid #e6e6e6;
}

.btn {
  padding:10px 16px;
  border-radius:6px;
  font-size:13px;
  cursor:pointer;
  border: none;
  font-weight: 500;
}

.btn-cancel {
  background:#f5f5f5;
  color:#333;
  border: 1px solid #ddd;
}

.btn-cancel:hover {
  background: #e8e8e8;
}

.btn-save {
  background:#2ecc71;
  color:white;
}

.btn-save:hover {
  background: #27ae60;
}

/* Overlay */
.overlay {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.3);
  display:none;
  z-index:1000;
}

.overlay.show {
  display:block;
}

/* Delete Modal */
.modal-overlay {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.4);
  display:none;
  z-index:1500;
  align-items: center;
  justify-content: center;
}

.modal-overlay.show {
  display: flex;
}

.modal {
  background:white;
  border-radius:8px;
  padding:24px;
  width:90%;
  max-width:400px;
  box-shadow:0 10px 40px rgba(0,0,0,0.2);
}

.modal h4 {
  margin-bottom:12px;
  font-size:16px;
  color: #333;
}

.modal p {
  color:#666;
  font-size:14px;
  margin-bottom:20px;
  line-height: 1.5;
}

.modal-actions {
  display:flex;
  gap:10px;
  justify-content:flex-end;
}

.modal-cancel {
  background:#f5f5f5;
  color:#333;
  border: 1px solid #ddd;
  padding:8px 16px;
  border-radius:6px;
  cursor: pointer;
}

.modal-delete {
  background:#db1818;
  color:white;
  border: none;
  padding:8px 16px;
  border-radius:6px;
  cursor: pointer;
}

/* Toast */
.toast {
  position:fixed;
  top:20px;
  right:20px;
  background:#e4f9ec;
  color:#0a8f43;
  border:1px solid #b8e6c8;
  padding:14px 18px;
  border-radius:8px;
  font-size:13px;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  z-index:2000;
  opacity:0;
  transform:translateY(-20px);
  transition:all 0.4s ease;
}

.toast.show {
  opacity:1;
  transform:translateY(0);
}

/* Footer */
.footer {
  position:fixed;
  bottom:20px;
  right:20px;
  display:flex;
  gap:10px;
  z-index:999;
}

.footer .btn {
  padding:10px 20px;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .layout {
    grid-template-columns: 260px 1fr;
  }
  
  .widget-grid {
    grid-template-columns: repeat(8, 1fr);
  }
  
  .config-panel {
    width: 400px;
    right: -400px;
  }
}

@media (max-width: 768px) {
  .layout {
    grid-template-columns: 1fr;
  }
  
  .sidebar {
    display: none;
  }
  
  .widget-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .config-panel {
    width: 100%;
    right: -100%;
  }
  
  .footer {
    bottom: 10px;
    right: 10px;
    gap: 8px;
  }
  
  .footer .btn {
    padding: 8px 14px;
    font-size: 12px;
  }
}

@media (max-width: 480px) {
  .widget-grid {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .config-input,
  .config-select,
  .config-textarea {
    font-size: 16px; /* Prevent zoom on iOS */
  }
  
  .canvas {
    padding: 12px;
  }
}
</style>
</head>

<body>

<!-- Toast -->
<div id="toast" class="toast">‚úî Widget configuration saved successfully</div>

<!-- Overlay -->
<div class="overlay" id="overlay" onclick="closePanel(); closeDeleteModal();"></div>

<!-- Delete Modal -->
<div class="modal-overlay" id="deleteModalOverlay" onclick="closeDeleteModal()">
  <div class="modal" onclick="event.stopPropagation()">
    <h4>Delete Widget</h4>
    <p id="deleteMessage">Are you sure you want to delete this widget?</p>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closeDeleteModal()">Cancel</button>
      <button class="modal-delete" onclick="performDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- Config Panel -->
<div class="config-panel" id="configPanel">
  <h3>Widget Configuration</h3>
  
  <div class="config-group">
    <label class="config-label">Widget Title *</label>
    <input type="text" class="config-input" id="configTitle" value="Untitled">
  </div>

  <div class="config-group">
    <label class="config-label">Widget Type *</label>
    <select class="config-select" id="configType" onchange="updateConfigForm()">
      <option value="KPI">KPI Card</option>
      <option value="BarChart">Bar Chart</option>
      <option value="LineChart">Line Chart</option>
      <option value="PieChart">Pie Chart</option>
      <option value="AreaChart">Area Chart</option>
      <option value="ScatterPlot">Scatter Plot</option>
      <option value="Table">Table</option>
    </select>
  </div>

  <div class="config-group">
    <label class="config-label">Description</label>
    <textarea class="config-textarea" id="configDescription" placeholder="Add a description..."></textarea>
  </div>

  <div class="config-group">
    <label class="config-label">Width (Columns) *</label>
    <input type="number" class="config-input" id="configWidth" value="3" min="1" max="12">
  </div>

  <div class="config-group">
    <label class="config-label">Height (Rows) *</label>
    <input type="number" class="config-input" id="configHeight" value="2" min="1">
  </div>

  <div id="kpiConfig">
    <div class="config-group">
      <label class="config-label">Select Metric *</label>
      <select class="config-select" id="configMetric">
        <option value="">-- Select Metric --</option>
        <option value="total-orders">Total Orders</option>
        <option value="total-revenue">Total Revenue</option>
        <option value="avg-order-value">Avg Order Value</option>
        <option value="pending-orders">Pending Orders</option>
      </select>
    </div>

    <div class="config-group">
      <label class="config-label">Aggregation *</label>
      <select class="config-select" id="configAggregation">
        <option value="Sum">Sum</option>
        <option value="Average">Average</option>
        <option value="Count">Count</option>
      </select>
    </div>

    <div class="config-group">
      <label class="config-label">Data Format *</label>
      <select class="config-select" id="configFormat">
        <option value="Number">Number</option>
        <option value="Currency">Currency</option>
      </select>
    </div>

    <div class="config-group">
      <label class="config-label">Decimal Precision</label>
      <input type="number" class="config-input" id="configPrecision" value="0" min="0">
    </div>
  </div>

  <div id="chartConfig" style="display:none;">
    <div class="config-group">
      <label class="config-label">X-Axis Data *</label>
      <select class="config-select" id="configXAxis">
        <option value="">-- Select --</option>
        <option value="product">Product</option>
        <option value="status">Status</option>
        <option value="created-by">Created By</option>
        <option value="order-date">Order Date</option>
      </select>
    </div>

    <div class="config-group">
      <label class="config-label">Y-Axis Data *</label>
      <select class="config-select" id="configYAxis">
        <option value="">-- Select --</option>
        <option value="quantity">Quantity</option>
        <option value="total-amount">Total Amount</option>
        <option value="unit-price">Unit Price</option>
      </select>
    </div>

    <div class="config-group">
      <label class="config-label">Chart Color</label>
      <input type="color" class="config-input" id="configChartColor" value="#0a9b48">
    </div>

    <div class="config-group">
      <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
        <input type="checkbox" id="configShowLabel">
        Show Data Labels
      </label>
    </div>
  </div>

  <div id="tableConfig" style="display:none;">
    <div class="config-group">
      <label class="config-label">Select Columns *</label>
      <div style="border: 1px solid #ddd; border-radius: 6px; padding: 10px; max-height: 200px; overflow-y: auto;">
        <label style="display: block; margin-bottom: 8px; cursor: pointer;"><input type="checkbox" value="first-name"> First Name</label>
        <label style="display: block; margin-bottom: 8px; cursor: pointer;"><input type="checkbox" value="last-name"> Last Name</label>
        <label style="display: block; margin-bottom: 8px; cursor: pointer;"><input type="checkbox" value="email"> Email</label>
        <label style="display: block; margin-bottom: 8px; cursor: pointer;"><input type="checkbox" value="product"> Product</label>
        <label style="display: block; margin-bottom: 8px; cursor: pointer;"><input type="checkbox" value="quantity"> Quantity</label>
        <label style="display: block; margin-bottom: 8px; cursor: pointer;"><input type="checkbox" value="total-amount"> Total Amount</label>
        <label style="display: block; cursor: pointer;"><input type="checkbox" value="status"> Status</label>
      </div>
    </div>

    <div class="config-group">
      <label class="config-label">Rows Per Page</label>
      <select class="config-select" id="configPagination">
        <option value="5">5</option>
        <option value="10" selected>10</option>
        <option value="15">15</option>
      </select>
    </div>

    <div class="config-group">
      <label class="config-label">Font Size</label>
      <input type="number" class="config-input" id="configFontSize" value="14" min="12" max="18">
    </div>
  </div>

  <div class="config-footer">
    <button class="btn btn-cancel" onclick="closePanel()">Cancel</button>
    <button class="btn btn-save" onclick="saveWidget()">Save Configuration</button>
  </div>
</div>

<!-- Topbar -->
<div class="topbar">
  <button class="back-btn" onclick="goBack()">‚Üê</button>
  <div>
    <h3>Configure Dashboard</h3>
    <p>Design your personalized dashboard with widgets</p>
  </div>
</div>

<div class="layout">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="control-group">
      <label class="control-label">Show data for</label>
      <select class="control-input" id="dateFilter" onchange="applyFilter()">
        <option value="all-time">All time</option>
        <option value="today">Today</option>
        <option value="7days">Last 7 Days</option>
        <option value="30days">Last 30 Days</option>
        <option value="90days">Last 90 Days</option>
      </select>
    </div>

    <div class="control-group">
      <label class="control-label" style="margin-bottom: 12px; display: block;">Widget Library</label>
      <small style="color:#888; display:block; margin-bottom:12px;">Drag widgets to canvas</small>

      <div class="section-header" onclick="toggleSection(this)">
        <span>üìä Charts</span>
        <span class="section-toggle">‚åÑ</span>
      </div>
      <div class="section-content">
        <div class="widget-item" draggable="true" ondragstart="dragStart(event, 'BarChart', 'Bar Chart')">üìä Bar Chart</div>
        <div class="widget-item" draggable="true" ondragstart="dragStart(event, 'LineChart', 'Line Chart')">üìà Line Chart</div>
        <div class="widget-item" draggable="true" ondragstart="dragStart(event, 'AreaChart', 'Area Chart')">üìâ Area Chart</div>
        <div class="widget-item" draggable="true" ondragstart="dragStart(event, 'ScatterPlot', 'Scatter Plot')">‚óè Scatter Plot</div>
        <div class="widget-item" draggable="true" ondragstart="dragStart(event, 'PieChart', 'Pie Chart')">‚≠ï Pie Chart</div>
      </div>

      <div class="section-header" onclick="toggleSection(this)">
        <span>üìã Tables</span>
        <span class="section-toggle">‚åÑ</span>
      </div>
      <div class="section-content">
        <div class="widget-item" draggable="true" ondragstart="dragStart(event, 'Table', 'Table')">üìÑ Table</div>
      </div>

      <div class="section-header" onclick="toggleSection(this)">
        <span>‚≠ê KPIs</span>
        <span class="section-toggle">‚åÑ</span>
      </div>
      <div class="section-content">
        <div class="widget-item" draggable="true" ondragstart="dragStart(event, 'KPI', 'KPI Card')">‚≠ê KPI Value</div>
      </div>
    </div>
  </div>

  <!-- Canvas -->
  <div class="canvas" id="canvas" ondrop="drop(event)" ondragover="dragOver(event)">
    <div class="widget-grid" id="widgetGrid">
      <!-- Widgets will be added here -->
    </div>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  <button class="btn btn-cancel" onclick="goBack()">Cancel</button>
  <button class="btn btn-save" onclick="saveDashboard()">Save Dashboard</button>
</div>

<script>
let widgets = [];
let currentEditingWidget = null;
let deleteTarget = null;
let draggedType = null;
let draggedTitle = null;

// Load widgets from localStorage
function loadWidgets() {
  const saved = localStorage.getItem('dashboardWidgets');
  widgets = saved ? JSON.parse(saved) : [];
  renderWidgets();
}

function renderWidgets() {
  const grid = document.getElementById('widgetGrid');
  grid.innerHTML = '';
  
  widgets.forEach((widget, index) => {
    const div = createWidgetElement(widget, index);
    grid.appendChild(div);
  });
}

function createWidgetElement(widget, index) {
  const div = document.createElement('div');
  div.className = 'widget';
  div.style.gridColumn = `span ${Math.min(widget.width || 3, 12)}`;
  div.id = `widget-${index}`;
  
  let value = '0';
  if (widget.type === 'KPI') {
    value = calculateKPIValue(widget.metric);
  }
  
  div.innerHTML = `
    <div class="widget-title">${widget.title || 'Untitled'}</div>
    <div class="widget-type">${widget.type}</div>
    <div class="widget-value">${value}</div>
    <div class="widget-label">${widget.description || 'Widget'}</div>
    <div class="widget-actions">
      <button class="widget-btn settings-btn" onclick="editWidget(${index})" title="Settings">‚öô</button>
      <button class="widget-btn delete-btn" onclick="confirmDelete(${index})" title="Delete">üóë</button>
    </div>
  `;
  
  return div;
}

function calculateKPIValue(metric) {
  const orders = JSON.parse(localStorage.getItem('customerOrders')) || [];
  
  switch(metric) {
    case 'total-orders':
      return orders.length;
    case 'total-revenue':
      return orders.reduce((sum, o) => sum + (o.totalAmount || 0), 0).toFixed(2);
    case 'avg-order-value':
      return orders.length > 0 ? (orders.reduce((sum, o) => sum + (o.totalAmount || 0), 0) / orders.length).toFixed(2) : '0';
    case 'pending-orders':
      return orders.filter(o => o.status === 'Pending').length;
    default:
      return '0';
  }
}

function addWidget(type, title) {
  const widget = {
    id: Date.now(),
    type: type,
    title: title,
    width: type === 'Table' ? 6 : (type === 'KPI' ? 3 : 5),
    height: 2,
    description: ''
  };
  
  widgets.push(widget);
  renderWidgets();
  showToast('Widget added successfully!');
}

function editWidget(index) {
  currentEditingWidget = index;
  const widget = widgets[index];
  
  document.getElementById('configTitle').value = widget.title;
  document.getElementById('configType').value = widget.type;
  document.getElementById('configDescription').value = widget.description || '';
  document.getElementById('configWidth').value = widget.width;
  document.getElementById('configHeight').value = widget.height;
  
  if (widget.type === 'KPI') {
    document.getElementById('configMetric').value = widget.metric || '';
  }
  
  updateConfigForm();
  openPanel();
}

function updateConfigForm() {
  const type = document.getElementById('configType').value;
  const kpiConfig = document.getElementById('kpiConfig');
  const chartConfig = document.getElementById('chartConfig');
  const tableConfig = document.getElementById('tableConfig');
  
  kpiConfig.style.display = type === 'KPI' ? 'block' : 'none';
  chartConfig.style.display = ['BarChart', 'LineChart', 'AreaChart', 'ScatterPlot', 'PieChart'].includes(type) ? 'block' : 'none';
  tableConfig.style.display = type === 'Table' ? 'block' : 'none';
}

function saveWidget() {
  const widget = {
    id: widgets[currentEditingWidget].id,
    type: document.getElementById('configType').value,
    title: document.getElementById('configTitle').value || 'Untitled',
    description: document.getElementById('configDescription').value,
    width: parseInt(document.getElementById('configWidth').value),
    height: parseInt(document.getElementById('configHeight').value),
    metric: document.getElementById('configMetric')?.value,
    xAxis: document.getElementById('configXAxis')?.value,
    yAxis: document.getElementById('configYAxis')?.value,
    chartColor: document.getElementById('configChartColor')?.value,
    showLabel: document.getElementById('configShowLabel')?.checked,
    fontSize: document.getElementById('configFontSize')?.value,
    pagination: document.getElementById('configPagination')?.value
  };
  
  widgets[currentEditingWidget] = widget;
  renderWidgets();
  closePanel();
  showToast('Widget configuration saved!');
}

function confirmDelete(index) {
  deleteTarget = index;
  const widget = widgets[index];
  document.getElementById('deleteMessage').innerText = `Are you sure you want to delete the "${widget.title}" widget?`;
  document.getElementById('deleteModalOverlay').classList.add('show');
}

function closeDeleteModal() {
  deleteTarget = null;
  document.getElementById('deleteModalOverlay').classList.remove('show');
}

function performDelete() {
  if (deleteTarget !== null) {
    widgets.splice(deleteTarget, 1);
    renderWidgets();
    closeDeleteModal();
    showToast('Widget deleted successfully');
  }
}

function openPanel() {
  document.getElementById('configPanel').classList.add('open');
  document.getElementById('overlay').classList.add('show');
}

function closePanel() {
  document.getElementById('configPanel').classList.remove('open');
  document.getElementById('overlay').classList.remove('show');
}

function dragStart(event, type, title) {
  draggedType = type;
  draggedTitle = title;
  event.dataTransfer.effectAllowed = 'copy';
}

function dragOver(event) {
  event.preventDefault();
  event.dataTransfer.dropEffect = 'copy';
}

function drop(event) {
  event.preventDefault();
  if (draggedType) {
    addWidget(draggedType, draggedTitle);
    draggedType = null;
    draggedTitle = null;
  }
}

function saveDashboard() {
  localStorage.setItem('dashboardWidgets', JSON.stringify(widgets));
  localStorage.setItem('dashboardConfig', JSON.stringify(widgets));
  showToast('Dashboard saved successfully!');
  
  setTimeout(() => {
    window.location.href = 'main.html';
  }, 1500);
}

function showToast(message) {
  const toast = document.getElementById('toast');
  toast.textContent = message || '‚úî Configuration saved successfully';
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

function goBack() {
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.location.href = 'main.html';
  }
}

function toggleSection(header) {
  const content = header.nextElementSibling;
  if (content && content.classList.contains('section-content')) {
    content.classList.toggle('collapsed');
    header.classList.toggle('collapsed');
  }
}

function applyFilter() {
  const filter = document.getElementById('dateFilter').value;
  console.log('Date filter applied:', filter);
}

// Initialize on load
window.addEventListener('load', loadWidgets);
window.addEventListener('storage', loadWidgets);
</script>

</body>
</html>
